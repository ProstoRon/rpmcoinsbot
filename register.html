<!DOCTYPE html>
<html>
<head>
    <title>Регистрация</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Ваши стили */
    </style>
</head>
<body>
    <div class="container">
        <h1>Регистрация</h1>
        <div class="input-container">
            <input type="text" id="userIdInput" class="input" placeholder="Введите никнейм">
        </div>
        <div class="input-container password">
            <input type="password" id="passwordInput" class="input" placeholder="Введите пароль">
            <i class="fas fa-eye password-eye" id="togglePassword"></i>
        </div>
        <button class="button" id="registerButton">Регистрация</button>
        <div id="error-message"></div>
    </div>
    <!-- Подключаем Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            // Ваши настройки
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        function register() {
            const nickname = document.getElementById('userIdInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            const errorMessage = document.getElementById('error-message');

            if (!nickname || !password) {
                errorMessage.textContent = 'Пожалуйста, введите никнейм и пароль.';
                return;
            }

            const email = `${nickname}@example.com`;

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const userId = userCredential.user.uid;
                    set(ref(database, `users/${nickname}`), {
                        clicks: 0,
                        energy: 1000,
                        maxenergy: 1000,
                        totalClicks: 0,
                        password: password
                    });
                    window.location.href = 'index.html';
                })
                .catch((error) => {
                    errorMessage.textContent = `Ошибка регистрации: ${error.message}`;
                });
        }

        const passwordInput = document.getElementById('passwordInput');
        const togglePassword = document.getElementById('togglePassword');

        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.classList.toggle('fa-eye-slash');
        });

        document.getElementById('registerButton').addEventListener('click', register);
    </script>
</body>
</html>
